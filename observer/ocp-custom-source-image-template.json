{
   "apiVersion": "template.openshift.io/v1",
   "kind": "Template",
   "message": "The SDI Observer will be started. You can watch the progress with the following commands:\n\n  oc logs -f bc/sdi-observer\n  oc logs -f dc/sdi-observer\n\nThe SDI observer image will be first built and pushed to the integrated OpenShift image\nregistry. That will trigger a new rollout of its deployment config.\n",
   "metadata": {
      "annotations": {
         "description": "The template spawns the \"sdi-observer\" pod that observes the particular namespace where\nSAP Data Intelligence (SDI) runs and modifies its deployments and configuration to enable\nits pods to run on Red Hat OpenShift.\n\nOn Red Hat Enterprise Linux CoreOS, SDI's vsystem-vrep statefulset needs to be patched to\nmount `emptyDir` volume at `/exports` directory in order to enable NFS exports in the\ncontainer running on top of overlayfs which is the default filesystem in RHCOS.\n\nThe observer pod modifies vsystem-vrep statefulset as soon as it appears to enable the NFS\nexports.\n\nAdditionally, it patches diagnostics-fluentd daemonset to allow its pods to access log\nfiles on the host system. It also modifies it to parse plain text log files instead of\npreconfigured json.\n\nOn Red Hat Enterprise Linux CoreOS, \"vsystem-iptables\" containers need to be run as\nprivileged in order to load iptables-related kernel modules. SDI containers named\n\"vsystem-iptables\" deployed as part of every \"vsystem-app\" deployment attempt to modify\niptables rules without having the necessary permissions. The ideal solution is to pre-load\nthese modules during node's startup. When not feasable, this template can also fix the\npermissions on-the-fly as the deployments are created. The drawback is a slower startup of\nSDI components.\n\nBy default, observer also exposes SDI vsystem service as a route using OpenShift Ingress\ncontroller.\n\nThe template must be instantiated before the SDI installation. It is stronly recommended\nto run the observer in a separate namespace from SDI.\n\nPrerequisites:\n  - OCP cluster must be healty including all the cluster operators.\n  - The OCP integrated image registry must be properly configured and working.\n  - Pull secret for the registry.redhat.io must be configured.\n\nUsage:\n  Assuming the SDI will be run in the SDI_NAMESPACE which is different from the observer\n  NAMESPACE, instantiate the template with parameters like this:\n\n    oc new-project $SDI_NAMESPACE\n    oc new-project sdi-observer\n    oc process sdi-observer \\\n        SDI_NAMESPACE=$SDI_NAMESPACE \\\n        NAMESPACE=sdi-observer | oc create -f -\n",
         "openshift.io/display-name": "OpenShift enabler and observer for SAP Data intelligence\n",
         "openshift.io/documentation-url": "https://access.redhat.com/articles/4324391",
         "openshift.io/provider-display-name": "Red Hat, Inc.",
         "sdi-observer/version": "0.1.26"
      },
      "name": "sdi-observer"
   },
   "objects": [
      {
         "apiVersion": "v1",
         "kind": "ServiceAccount",
         "metadata": {
            "labels": {
               "app": "sdi-observer",
               "created-by": "sdi-observer-template",
               "deploymentconfig": "sdi-observer"
            },
            "name": "sdi-observer",
            "namespace": "${NAMESPACE}"
         }
      },
      {
         "apiVersion": "v1",
         "kind": "DeploymentConfig",
         "metadata": {
            "labels": {
               "app": "sdi-observer",
               "created-by": "sdi-observer-template",
               "deploymentconfig": "sdi-observer",
               "sdi-observer/version": "0.1.26"
            },
            "name": "sdi-observer",
            "namespace": "${NAMESPACE}"
         },
         "spec": {
            "replicas": 1,
            "selector": {
               "deploymentconfig": "sdi-observer"
            },
            "strategy": {
               "type": "Recreate"
            },
            "template": {
               "metadata": {
                  "labels": {
                     "app": "sdi-observer",
                     "deploymentconfig": "sdi-observer"
                  }
               },
               "spec": {
                  "containers": [
                     {
                        "args": null,
                        "command": [
                           "/usr/local/bin/observer.sh"
                        ],
                        "env": [
                           {
                              "name": "SDI_OBSERVER_VERSION",
                              "value": "0.1.26"
                           },
                           {
                              "name": "NAMESPACE",
                              "value": "${NAMESPACE}"
                           },
                           {
                              "name": "DRY_RUN",
                              "value": "${DRY_RUN}"
                           },
                           {
                              "name": "FORCE_REDEPLOY",
                              "value": "${FORCE_REDEPLOY}"
                           },
                           {
                              "name": "REPLACE_SECRETS",
                              "value": "${REPLACE_SECRETS}"
                           },
                           {
                              "name": "OCP_MINOR_RELEASE",
                              "value": "${OCP_MINOR_RELEASE}"
                           },
                           {
                              "name": "SDI_OBSERVER_REPOSITORY",
                              "value": "${SDI_OBSERVER_REPOSITORY}"
                           },
                           {
                              "name": "SDI_OBSERVER_GIT_REVISION",
                              "value": "${SDI_OBSERVER_GIT_REVISION}"
                           },
                           {
                              "name": "SDI_NAMESPACE",
                              "value": "${SDI_NAMESPACE}"
                           },
                           {
                              "name": "SLCB_NAMESPACE",
                              "value": "${SLCB_NAMESPACE}"
                           },
                           {
                              "name": "NODE_LOG_FORMAT",
                              "value": "${NODE_LOG_FORMAT}"
                           },
                           {
                              "name": "SLCB_ROUTE_HOSTNAME",
                              "value": "${SLCB_ROUTE_HOSTNAME}"
                           },
                           {
                              "name": "MANAGE_SLCB_ROUTE",
                              "value": "${MANAGE_SLCB_ROUTE}"
                           },
                           {
                              "name": "INJECT_CABUNDLE",
                              "value": "${INJECT_CABUNDLE}"
                           },
                           {
                              "name": "CABUNDLE_SECRET_NAME",
                              "value": "${CABUNDLE_SECRET_NAME}"
                           },
                           {
                              "name": "MANAGE_VSYSTEM_ROUTE",
                              "value": "${MANAGE_VSYSTEM_ROUTE}"
                           },
                           {
                              "name": "VSYSTEM_ROUTE_HOSTNAME",
                              "value": "${VSYSTEM_ROUTE_HOSTNAME}"
                           },
                           {
                              "name": "DEPLOY_SDI_REGISTRY",
                              "value": "${DEPLOY_SDI_REGISTRY}"
                           },
                           {
                              "name": "DEPLOY_LETSENCRYPT",
                              "value": "${DEPLOY_LETSENCRYPT}"
                           },
                           {
                              "name": "LETSENCRYPT_ENVIRONMENT",
                              "value": "${LETSENCRYPT_ENVIRONMENT}"
                           },
                           {
                              "name": "SDI_NODE_SELECTOR",
                              "value": "${SDI_NODE_SELECTOR}"
                           },
                           {
                              "name": "REPLACE_PERSISTENT_VOLUME_CLAIMS",
                              "value": "${REPLACE_PERSISTENT_VOLUME_CLAIMS}"
                           },
                           {
                              "name": "REGISTRY",
                              "value": "${REGISTRY}"
                           },
                           {
                              "name": "SDI_REGISTRY_USERNAME",
                              "value": "${SDI_REGISTRY_USERNAME}"
                           },
                           {
                              "name": "SDI_REGISTRY_PASSWORD",
                              "value": "${SDI_REGISTRY_PASSWORD}"
                           },
                           {
                              "name": "SDI_REGISTRY_AUTHENTICATION",
                              "value": "${SDI_REGISTRY_AUTHENTICATION}"
                           },
                           {
                              "name": "SDI_REGISTRY_STORAGE_CLASS_NAME",
                              "value": "${SDI_REGISTRY_STORAGE_CLASS_NAME}"
                           },
                           {
                              "name": "SDI_REGISTRY_HTPASSWD_SECRET_NAME",
                              "value": "${SDI_REGISTRY_HTPASSWD_SECRET_NAME}"
                           },
                           {
                              "name": "SDI_REGISTRY_ROUTE_HOSTNAME",
                              "value": "${SDI_REGISTRY_ROUTE_HOSTNAME}"
                           },
                           {
                              "name": "SDI_REGISTRY_VOLUME_CAPACITY",
                              "value": "${SDI_REGISTRY_VOLUME_CAPACITY}"
                           },
                           {
                              "name": "SDI_REGISTRY_VOLUME_ACCESS_MODE",
                              "value": "${SDI_REGISTRY_VOLUME_ACCESS_MODE}"
                           },
                           {
                              "name": "EXPOSE_WITH_LETSENCRYPT",
                              "value": "${EXPOSE_WITH_LETSENCRYPT}"
                           },
                           {
                              "name": "SOURCE_IMAGESTREAM_NAME",
                              "value": "${SOURCE_IMAGESTREAM_NAME}"
                           },
                           {
                              "name": "SOURCE_IMAGESTREAM_TAG",
                              "value": "${SOURCE_IMAGESTREAM_TAG}"
                           },
                           {
                              "name": "SOURCE_IMAGE_PULL_SPEC",
                              "value": "${SOURCE_IMAGE_PULL_SPEC}"
                           }
                        ],
                        "image": " ",
                        "name": "sdi-observer",
                        "resources": {
                           "limits": {
                              "cpu": "2000m",
                              "memory": "2Gi"
                           },
                           "requests": {
                              "cpu": "400m",
                              "memory": "500Mi"
                           }
                        }
                     }
                  ],
                  "restartPolicy": "Always",
                  "serviceAccount": "sdi-observer",
                  "serviceAccountName": "sdi-observer"
               }
            },
            "triggers": [
               {
                  "type": "ConfigChange"
               },
               {
                  "imageChangeParams": {
                     "automatic": true,
                     "containerNames": [
                        "sdi-observer"
                     ],
                     "from": {
                        "kind": "ImageStreamTag",
                        "name": "sdi-observer:0.1.26-ocp${OCP_MINOR_RELEASE}"
                     }
                  },
                  "type": "ImageChange"
               }
            ]
         }
      },
      {
         "apiVersion": "rbac.authorization.k8s.io/v1",
         "kind": "ClusterRoleBinding",
         "metadata": {
            "labels": {
               "created-by": "sdi-observer-template",
               "deploymentconfig": "sdi-observer"
            },
            "name": "sdi-observer-admin-in-${NAMESPACE}"
         },
         "roleRef": {
            "apiGroup": "rbac.authorization.k8s.io",
            "kind": "ClusterRole",
            "name": "admin"
         },
         "subjects": [
            {
               "kind": "ServiceAccount",
               "name": "sdi-observer",
               "namespace": "${NAMESPACE}"
            }
         ]
      },
      {
         "apiVersion": "rbac.authorization.k8s.io/v1",
         "kind": "ClusterRole",
         "metadata": {
            "labels": {
               "created-by": "sdi-observer-template",
               "deploymentconfig": "sdi-observer"
            },
            "name": "sdi-observer-cluster-access-in-${NAMESPACE}"
         },
         "rules": [
            {
               "apiGroups": [
                  "config.openshift.io"
               ],
               "resources": [
                  "ingresses",
                  "clusteroperators"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch"
               ]
            },
            {
               "apiGroups": [
                  ""
               ],
               "resources": [
                  "namespaces"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "patch",
                  "update",
                  "delete"
               ]
            }
         ]
      },
      {
         "apiVersion": "rbac.authorization.k8s.io/v1",
         "kind": "ClusterRoleBinding",
         "metadata": {
            "labels": {
               "created-by": "sdi-observer-template",
               "deploymentconfig": "sdi-observer"
            },
            "name": "sdi-observer-cluster-access-in-${NAMESPACE}"
         },
         "roleRef": {
            "apiGroup": "rbac.authorization.k8s.io",
            "kind": "ClusterRole",
            "name": "sdi-observer-cluster-access-in-${NAMESPACE}"
         },
         "subjects": [
            {
               "kind": "ServiceAccount",
               "name": "sdi-observer",
               "namespace": "${NAMESPACE}"
            }
         ]
      },
      {
         "apiVersion": "rbac.authorization.k8s.io/v1",
         "kind": "Role",
         "metadata": {
            "labels": {
               "created-by": "sdi-observer-template",
               "deploymentconfig": "sdi-observer"
            },
            "name": "sdi-observer-in-${NAMESPACE}",
            "namespace": "${SDI_NAMESPACE}"
         },
         "rules": [
            {
               "apiGroups": [
                  ""
               ],
               "resources": [
                  "secrets"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "patch",
                  "update",
                  "delete",
                  "create",
                  "delete"
               ]
            },
            {
               "apiGroups": [
                  ""
               ],
               "resources": [
                  "configmaps"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "patch",
                  "update",
                  "delete"
               ]
            },
            {
               "apiGroups": [
                  "",
                  "authorization.openshift.io",
                  "rbac.authorization.k8s.io"
               ],
               "resources": [
                  "roles",
                  "rolebindings",
                  "serviceaccounts"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "patch",
                  "update",
                  "delete",
                  "create",
                  "delete"
               ]
            },
            {
               "apiGroups": [
                  ""
               ],
               "resources": [
                  "namespaces",
                  "namespaces/status"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "create"
               ]
            },
            {
               "apiGroups": [
                  "",
                  "project.openshift.io"
               ],
               "resources": [
                  "projects"
               ],
               "verbs": [
                  "get"
               ]
            },
            {
               "apiGroups": [
                  "apps",
                  "extensions"
               ],
               "resources": [
                  "deployments",
                  "deployments/scale",
                  "statefulsets",
                  "statefulsets/scale"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "patch",
                  "update",
                  "delete"
               ]
            },
            {
               "apiGroups": [
                  "apps",
                  "extensions"
               ],
               "resources": [
                  "daemonsets"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "patch",
                  "update",
                  "delete"
               ]
            },
            {
               "apiGroups": [
                  "apps",
                  "deploymentconfigs.apps.openshift.io"
               ],
               "resources": [
                  "deploymentconfigs"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "delete"
               ]
            },
            {
               "apiGroups": [
                  "route.openshift.io/v1"
               ],
               "resources": [
                  "routes"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "patch",
                  "update",
                  "delete",
                  "create",
                  "delete"
               ]
            },
            {
               "apiGroups": [
                  ""
               ],
               "resources": [
                  "service"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "patch",
                  "update",
                  "delete",
                  "create",
                  "delete"
               ]
            },
            {
               "apiGroups": [
                  "apiextensions.k8s.io"
               ],
               "resourceNames": [
                  "datahubs.installers.datahub.sap.com"
               ],
               "resources": [
                  "customresourcedefinitions"
               ],
               "verbs": [
                  "get"
               ]
            },
            {
               "apiGroups": [
                  "installers.datahub.sap.com"
               ],
               "resources": [
                  "voraclusters",
                  "datahubs"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "patch",
                  "update",
                  "delete"
               ]
            },
            {
               "apiGroups": [
                  "sap.com"
               ],
               "resources": [
                  "voraclusters"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch"
               ]
            },
            {
               "apiGroups": [
                  ""
               ],
               "resources": [
                  "events"
               ],
               "verbs": [
                  "create",
                  "delete",
                  "update",
                  "patch",
                  "deletecollection"
               ]
            },
            {
               "apiGroups": [
                  ""
               ],
               "resources": [
                  "pods/log"
               ],
               "verbs": [
                  "create",
                  "delete",
                  "update",
                  "patch",
                  "deletecollection"
               ]
            },
            {
               "apiGroups": [
                  "vsystem.datahub.sap.com"
               ],
               "resources": [
                  "appinstances"
               ],
               "verbs": [
                  "*"
               ]
            },
            {
               "apiGroups": [
                  "vsystem.datahub.sap.com"
               ],
               "resources": [
                  "workloads"
               ],
               "verbs": [
                  "*"
               ]
            },
            {
               "apiGroups": [
                  "vsystem.datahub.sap.com"
               ],
               "resources": [
                  "workloads/finalizers"
               ],
               "verbs": [
                  "update"
               ]
            }
         ]
      },
      {
         "apiVersion": "rbac.authorization.k8s.io/v1",
         "kind": "RoleBinding",
         "metadata": {
            "labels": {
               "created-by": "sdi-observer-template",
               "deploymentconfig": "sdi-observer"
            },
            "name": "sdi-observer-in-${NAMESPACE}",
            "namespace": "${SDI_NAMESPACE}"
         },
         "roleRef": {
            "apiGroup": "rbac.authorization.k8s.io",
            "kind": "Role",
            "name": "sdi-observer-in-${NAMESPACE}",
            "namespace": "${SDI_NAMESPACE}"
         },
         "subjects": [
            {
               "kind": "ServiceAccount",
               "name": "sdi-observer",
               "namespace": "${NAMESPACE}"
            }
         ]
      },
      {
         "apiVersion": "rbac.authorization.k8s.io/v1",
         "kind": "Role",
         "metadata": {
            "labels": {
               "created-by": "sdi-observer-template",
               "deploymentconfig": "sdi-observer"
            },
            "name": "sdi-observer-for-slcbridge-in-${NAMESPACE}",
            "namespace": "${SLCB_NAMESPACE}"
         },
         "rules": [
            {
               "apiGroups": [
                  "",
                  "project.openshift.io"
               ],
               "resources": [
                  "projects"
               ],
               "verbs": [
                  "get"
               ]
            },
            {
               "apiGroups": [
                  "",
                  "authorization.openshift.io",
                  "rbac.authorization.k8s.io"
               ],
               "resources": [
                  "roles",
                  "rolebindings",
                  "serviceaccounts"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "patch",
                  "update",
                  "delete",
                  "create",
                  "delete"
               ]
            },
            {
               "apiGroups": [
                  ""
               ],
               "resources": [
                  "namespaces",
                  "namespaces/status"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "create"
               ]
            },
            {
               "apiGroups": [
                  "apps",
                  "extensions"
               ],
               "resources": [
                  "daemonsets"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "patch",
                  "update",
                  "delete"
               ]
            },
            {
               "apiGroups": [
                  "route.openshift.io/v1"
               ],
               "resources": [
                  "routes"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "patch",
                  "update",
                  "delete",
                  "create",
                  "delete"
               ]
            },
            {
               "apiGroups": [
                  ""
               ],
               "resources": [
                  "service"
               ],
               "verbs": [
                  "get",
                  "list",
                  "watch",
                  "patch",
                  "update",
                  "delete",
                  "create",
                  "delete"
               ]
            }
         ]
      },
      {
         "apiVersion": "rbac.authorization.k8s.io/v1",
         "kind": "RoleBinding",
         "metadata": {
            "labels": {
               "created-by": "sdi-observer-template",
               "deploymentconfig": "sdi-observer"
            },
            "name": "sdi-observer-for-slcbridge-in-${NAMESPACE}",
            "namespace": "${SLCB_NAMESPACE}"
         },
         "roleRef": {
            "apiGroup": "rbac.authorization.k8s.io",
            "kind": "Role",
            "name": "sdi-observer-for-slcbridge-in-${NAMESPACE}",
            "namespace": "${SLCB_NAMESPACE}"
         },
         "subjects": [
            {
               "kind": "ServiceAccount",
               "name": "sdi-observer",
               "namespace": "${NAMESPACE}"
            }
         ]
      },
      {
         "apiVersion": "rbac.authorization.k8s.io/v1",
         "kind": "ClusterRoleBinding",
         "metadata": {
            "labels": {
               "created-by": "sdi-observer-template",
               "deploymentconfig": "sdi-observer"
            },
            "name": "sdi-observer-node-reader-in-${NAMESPACE}"
         },
         "roleRef": {
            "apiGroup": "rbac.authorization.k8s.io",
            "kind": "ClusterRole",
            "name": "system:node-reader"
         },
         "subjects": [
            {
               "kind": "ServiceAccount",
               "name": "sdi-observer",
               "namespace": "${NAMESPACE}"
            }
         ]
      },
      {
         "apiVersion": "build.openshift.io/v1",
         "kind": "BuildConfig",
         "metadata": {
            "labels": {
               "created-by": "sdi-observer-template",
               "deploymentconfig": "sdi-observer",
               "sdi-observer/version": "0.1.26"
            },
            "name": "sdi-observer",
            "namespace": "${NAMESPACE}"
         },
         "spec": {
            "output": {
               "to": {
                  "kind": "ImageStreamTag",
                  "name": "sdi-observer:0.1.26-ocp${OCP_MINOR_RELEASE}"
               }
            },
            "runPolicy": "Serial",
            "source": {
               "dockerfile": "FROM openshift/cli:latest\nLABEL maintainer=\"Michal Minář <miminar@redhat.com>\"\nRUN dnf update -y --skip-broken --nobest --disableplugin=subscription-manager ||:\n# TODO: jq is not yet available in EPEL-8\n# make sure to use epel (jq 1.6) instead of rhel repository (jq 1.5)\nRUN dnf install -y --disableplugin=subscription-manager \\\n  https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm && \\\n  dnf install --disableplugin=subscription-manager --disablerepo=\\* --enablerepo=epel -y jq\nRUN dnf install -y --disableplugin=subscription-manager \\\n    https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm && \\\n  dnf install -y --disableplugin=subscription-manager \\\n    parallel procps-ng bc git httpd-tools && dnf clean all -y && \\\n  rm -rf /var/cache/yum /var/cache/dnf\n# TODO: determine OCP version from environment\nRUN cd tmp; \\\n  curl -L -O https://mirror.openshift.com/pub/openshift-v4/clients/ocp/stable-${OCP_MINOR_RELEASE}/openshift-client-linux.tar.gz; \\\n  curl -L -O https://mirror.openshift.com/pub/openshift-v4/clients/ocp/stable-${OCP_MINOR_RELEASE}/sha256sum.txt\n# verify the downloaded tar\nRUN /bin/bash -c 'f=/tmp/openshift-client-linux.tar.gz; \\\n  got=\"$(awk '\"'\"'{print $1}'\"'\"' <(sha256sum \"$f\"))\"; \\\n  exp=\"$(awk '\"'\"'/openshift-client-linux-/ {print $1}'\"'\"' /tmp/sha256sum.txt | head -n 1)\"; \\\n  if [[ \"$got\" != \"$exp\" ]]; then printf \\\n    '\"'\"'Unexpected hashsum of %s (expected \"%s\", got \"%s\")\\n!'\"'\"' \"$f\" \"$exp\" \"$got\" >&2; \\\n    exit 1; \\\n  fi'\nRUN /bin/bash -c 'tar -C /usr/local/bin/ -xzvf /tmp/openshift-client-linux.tar.gz -T <(printf oc)'\nRUN rm -rfv /tmp/*\n# TODO: verify signatures as well\nRUN mkdir -p /usr/local/bin /usr/local/share/openshift-acme\nRUN git clone --depth 5 --single-branch \\\n  --branch ${LETSENCRYPT_REVISION} \\\n  ${LETSENCRYPT_REPOSITORY} /usr/local/share/openshift-acme\nRUN git clone --depth 5 --single-branch \\\n  --branch ${SDI_OBSERVER_GIT_REVISION} \\\n  ${SDI_OBSERVER_REPOSITORY} /usr/local/share/sap-data-intelligence\nRUN for bin in observer.sh deploy-registry.sh deploy-letsencrypt.sh; do \\\n      cp -lv $(find /usr/local/share/sap-data-intelligence \\\n                -type f -executable -name \"$bin\") \\\n        /usr/local/bin/$bin; \\\n      chmod a+rx /usr/local/bin/$bin; \\\n    done\nRUN ln -s /usr/local/share/sap-data-intelligence /usr/local/share/sdi\nWORKDIR /usr/local/share/sdi\nCMD [\"/usr/local/bin/observer.sh\"]"
            },
            "strategy": {
               "dockerStrategy": {
                  "from": {
                     "kind": "ImageStreamTag",
                     "name": "${SOURCE_IMAGESTREAM_NAME}:${SOURCE_IMAGESTREAM_TAG}"
                  },
                  "imageOptimizationPolicy": "SkipLayers"
               }
            },
            "triggers": [
               {
                  "type": "ImageChange"
               },
               {
                  "type": "ConfigChange"
               }
            ]
         }
      },
      {
         "apiVersion": "v1",
         "kind": "ImageStream",
         "metadata": {
            "labels": {
               "created-by": "sdi-observer-template",
               "sdi-observer/version": "0.1.26"
            },
            "name": "sdi-observer",
            "namespace": "${NAMESPACE}"
         },
         "spec": null,
         "status": {
            "dockerImageRepository": ""
         }
      },
      {
         "apiVersion": "v1",
         "kind": "ImageStream",
         "metadata": {
            "labels": {
               "created-by": "sdi-observer-template",
               "sdi-observer/version": "0.1.26"
            },
            "name": "${SOURCE_IMAGESTREAM_NAME}",
            "namespace": "${NAMESPACE}"
         },
         "spec": {
            "lookupPolicy": {
               "local": true
            },
            "tags": [
               {
                  "from": {
                     "kind": "DockerImage",
                     "name": "${SOURCE_IMAGE_PULL_SPEC}"
                  },
                  "importPolicy": {
                     "scheduled": true
                  },
                  "name": "${SOURCE_IMAGESTREAM_TAG}",
                  "referencePolicy": {
                     "type": "Source"
                  }
               }
            ]
         },
         "status": {
            "dockerImageRepository": ""
         }
      }
   ],
   "parameters": [
      {
         "description": "The desired namespace to deploy resources to. Defaults to the current one.\n",
         "name": "NAMESPACE",
         "required": true
      },
      {
         "description": "If set to true, no action will be performed. The pod will just print what would have been executed.",
         "name": "DRY_RUN",
         "required": false,
         "value": "false"
      },
      {
         "description": "Whether to forcefully replace existing objects and configuration files. To replace exising secrets as well, RECREATE_SECRETS needs to be set.",
         "name": "FORCE_REDEPLOY",
         "required": false,
         "value": "false"
      },
      {
         "description": "Whether to replace secrets like SDI Registry's htpasswd file if they exist already.",
         "name": "REPLACE_SECRETS",
         "required": false,
         "value": "false"
      },
      {
         "description": "Minor release of OpenShift Container Platform (e.g. 4.2). This value must match the OCP server version. The biggest tolerated difference between the versions is 1 in the second digit.",
         "name": "OCP_MINOR_RELEASE",
         "required": true,
         "value": "4.8"
      },
      {
         "description": "URL of SDI Observer's git repository to clone into sdi-observer image.",
         "name": "SDI_OBSERVER_REPOSITORY",
         "required": true,
         "value": "https://github.com/redhat-sap/sap-data-intelligence"
      },
      {
         "description": "Revision (e.g. tag, commit or branch) of SDI Observer's git repository to check out.",
         "name": "SDI_OBSERVER_GIT_REVISION",
         "required": true,
         "value": "master"
      },
      {
         "description": "The name of the SAP Data Intelligence namespace to manage. Should be set to a namespace other than NAMESPACE.",
         "name": "SDI_NAMESPACE",
         "required": true
      },
      {
         "description": "The name of the namespace where SLC Bridge runs.",
         "name": "SLCB_NAMESPACE",
         "required": true,
         "value": "sap-slcbridge"
      },
      {
         "description": "Format of the logging files on the nodes. Allowed values are \"json\" and \"text\". Initially, SDI fluentd pods are configured to parse \"json\" while OpenShift 4 uses \"text\" format by default. If not given, the default is \"text\".",
         "name": "NODE_LOG_FORMAT",
         "required": false
      },
      {
         "description": "Expose SLC Bridge's service at the provided hostname using a route. If not given, it will be exposed at <SLCB_NAMESPACE>.apps.<clustername>.<basedomainname>.",
         "name": "SLCB_ROUTE_HOSTNAME",
         "required": false
      },
      {
         "description": "Whether to create a route for SLC Bridge service in SLCB_NAMESPACE. The route will be of passthrough type. If set to \"remove\", the route will be deleted.",
         "name": "MANAGE_SLCB_ROUTE",
         "required": false,
         "value": "true"
      },
      {
         "description": "Inject CA certificate bundle into SAP Data Intelligence pods. The bundle can be specified with CABUNDLE_SECRET_NAME. It is needed if either registry or s3 endpoint is secured by a self-signed certificate.",
         "name": "INJECT_CABUNDLE",
         "required": false,
         "value": "false"
      },
      {
         "description": "The name of the secret containing certificate authority bundle that shall be injected into Data Intelligence pods. By default, the secret bundle is obtained from openshift-ingress-operator namespace where the router-ca secret contains the certificate authority used to signed all the edge and reencrypt routes that are inter alia used for SDI_REGISTRY and NooBaa S3 API services. The secret name may be optionally prefixed with $namespace/. For example, in the default value \"openshift-ingress-operator/router-ca\", the \"openshift-ingress-operator\" stands for secret's namespace and \"router-ca\" stands for secret's name. If no $namespace prefix is given, the secret is expected to reside in NAMESPACE where the SDI observer runs. All the entries present in the \"data\" field having \".crt\" or \".pem\" suffix will be concatenated to form the resulting \"cert\" file. This bundle will also be used to create cmcertificates secret in SDI_NAMESPACE according to https://help.sap.com/viewer/a8d90a56d61a49718ebcb5f65014bbe7/3.0.latest/en-US/39e8e391d5984e919725e601f089db74.html",
         "name": "CABUNDLE_SECRET_NAME",
         "required": false,
         "value": "openshift-ingress-operator/router-ca"
      },
      {
         "description": "Whether to create vsystem route for vsystem service in SDI_NAMESPACE. The route will be of reencrypt type. The destination CA certificate for communication with the vsystem service will be kept up to date by the observer. If set to \"remove\", the route will be deleted, which is useful to temporarily disable access to vsystem service during SDI updates.",
         "name": "MANAGE_VSYSTEM_ROUTE",
         "required": false,
         "value": "true"
      },
      {
         "description": "Expose the vsystem service at the provided hostname using a route. The value is applied only if MANAGE_VSYSTEM_ROUTE is enabled. The hostname defaults to\n vsystem-<SDI_NAMESPACE>.apps.<clustername>.<basedomainname>",
         "name": "VSYSTEM_ROUTE_HOSTNAME",
         "required": false
      },
      {
         "description": "Whether to deploy container image registry for the purpose of SAP Data Intelligence.\nRequires project admin role attached to the sdi-observer service account.\n",
         "name": "DEPLOY_SDI_REGISTRY",
         "required": false,
         "value": "false"
      },
      {
         "description": "(deprecated since 0.1.13) Whether to deploy letsencrypt controller. Requires project admin role attached to the sdi-observer service account.",
         "name": "DEPLOY_LETSENCRYPT",
         "required": false,
         "value": "false"
      },
      {
         "description": "(deprecated since 0.1.13) Either \"live\" or \"staging\". Use the latter when debugging SDI Observer's deployment.",
         "name": "LETSENCRYPT_ENVIRONMENT",
         "required": false,
         "value": "live"
      },
      {
         "description": "Make pods in SDI_NAMESPACE schedule only on nodes matching the given node selector. The selector will be applied to the whole namespace and its daemonsets. Selector can contain multiple key=value labels separated with commas.\nExample value: node-role.kubernetes.io/sdi=",
         "name": "SDI_NODE_SELECTOR",
         "required": false
      },
      {
         "description": "Whether to replace existing persistent volume claims like the one belonging to SDI Registry.",
         "name": "REPLACE_PERSISTENT_VOLUME_CLAIMS",
         "required": false,
         "value": "false"
      },
      {
         "description": "(deprecated since 0.1.13) The registry to mark as insecure. If not given, it will be determined from the installer-config secret in the SDI_NAMESPACE. If DEPLOY_SDI_REGISTRY is set to \"true\", this variable will be used as the container image registry's hostname when creating the corresponding route.",
         "name": "REGISTRY",
         "required": false
      },
      {
         "description": "Will be used to generate htpasswd file to provide authentication data to the SDI Registry service as long as SDI_REGISTRY_HTPASSWD_SECRET_NAME does not exist or REPLACE_SECRETS is \"true\".",
         "from": "user-[a-z0-9]{6}",
         "generate": "expression",
         "name": "SDI_REGISTRY_USERNAME",
         "required": false
      },
      {
         "description": "Will be used to generate htpasswd file to provide authentication data to the SDI Registry service as long as SDI_REGISTRY_HTPASSWD_SECRET_NAME does not exist or REPLACE_SECRETS is \"true\".",
         "from": "[a-zA-Z0-9]{32}",
         "generate": "expression",
         "name": "SDI_REGISTRY_PASSWORD",
         "required": false
      },
      {
         "description": "Choose the authentication method of the SDI Registry. Value \"none\" disables authentication altogether. Defaults to \"basic\" where the provided htpasswd file is used to gate the incoming authentication requests.",
         "name": "SDI_REGISTRY_AUTHENTICATION",
         "required": false,
         "value": "basic"
      },
      {
         "description": "Unless given, the default storage class will be used.",
         "name": "SDI_REGISTRY_STORAGE_CLASS_NAME",
         "required": false
      },
      {
         "description": "A secret with htpasswd file with authentication data for the sdi image container If given and the secret exists, it will be used instead of SDI_REGISTRY_USERNAME and SDI_REGISTRY_PASSWORD.",
         "name": "SDI_REGISTRY_HTPASSWD_SECRET_NAME",
         "required": false,
         "value": "container-image-registry-htpasswd"
      },
      {
         "description": "Desired hostname of the exposed registry service. Defaults to container-image-registry-<NAMESPACE>-apps.<cluster_name>.<base_domain>Overrides REGISTRY parameter.",
         "name": "SDI_REGISTRY_ROUTE_HOSTNAME",
         "required": false
      },
      {
         "description": "Volume space available for container images (e.g. 120Gi).",
         "name": "SDI_REGISTRY_VOLUME_CAPACITY",
         "required": false,
         "value": "120Gi"
      },
      {
         "description": "If the given SDI_REGISTRY_STORAGE_CLASS_NAME or the default storate class supports \"ReadWriteMany\" (\"RWX\") access mode, please change this to \"ReadWriteMany\".",
         "name": "SDI_REGISTRY_VOLUME_ACCESS_MODE",
         "required": false,
         "value": "ReadWriteOnce"
      },
      {
         "description": "(deprecated since 0.1.13) Whether to expose routes annotated for letsencrypt controller. Requires project admin role attached to the sdi-observer service account. Letsencrypt controller must be deployed either via this observer or cluster-wide for this to have an effect.Defaults to the value of DEPLOY_LETSENCRYPT.",
         "name": "EXPOSE_WITH_LETSENCRYPT",
         "required": false
      },
      {
         "description": "(deprecated since 0.1.13) Unless given, a local copy will be used.",
         "name": "LETSENCRYPT_REPOSITORY",
         "required": false,
         "value": "https://github.com/tnozicka/openshift-acme"
      },
      {
         "description": "(deprecated since 0.1.13) Revision of letsencrypt repository to check out.",
         "name": "LETSENCRYPT_REVISION",
         "required": false,
         "value": "master"
      },
      {
         "description": "Pull specification for the base image for sdi-observer and/or container-image-registry.\nThe base image shall be RPM based and contain \"dnf\" binary for package management.\n",
         "name": "SOURCE_IMAGE_PULL_SPEC",
         "required": true,
         "value": "registry.centos.org/centos:8"
      },
      {
         "description": "Name of the imagestream to use for the custom source image.\n",
         "name": "SOURCE_IMAGESTREAM_NAME",
         "required": true,
         "value": "centos8"
      },
      {
         "description": "Tag in the custom source imagestream referring to the SOURCE_IMAGE_PULL_SPEC.\n",
         "name": "SOURCE_IMAGESTREAM_TAG",
         "required": true,
         "value": "latest"
      }
   ]
}
